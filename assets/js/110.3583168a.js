(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{396:function(s,t,v){"use strict";v.r(t);var a=v(14),_=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_5-3-断网了-还能-ping-通-127-0-0-1-吗"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-断网了-还能-ping-通-127-0-0-1-吗"}},[s._v("#")]),s._v(" 5.3 断网了，还能 ping 通 127.0.0.1 吗？")]),s._v(" "),t("blockquote",[t("p",[s._v("来源：公众号@小白 debug")]),s._v(" "),t("p",[s._v("原文地址："),t("a",{attrs:{href:"https://mp.weixin.qq.com/s/qqfnyw4wKFjJqnV1eoRDhw",target:"_blank",rel:"noopener noreferrer"}},[s._v("断网了，还能 ping 通 127.0.0.1 吗？"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("你"),t("strong",[s._v("女神爱不爱你")]),s._v("，你问她，她可能不会告诉你。")]),s._v(" "),t("p",[s._v("但"),t("strong",[s._v("网通不通")]),s._v("，你 "),t("code",[s._v("ping")]),s._v(" 一下就知道了。")]),s._v(" "),t("p",[s._v("可能看到标题，你就知道答案了，但是你了解背后的原因吗？")]),s._v(" "),t("p",[s._v("那如果把 "),t("code",[s._v("127.0.0.1")]),s._v(" 换成 "),t("code",[s._v("0.0.0.0")]),s._v(" 或 "),t("code",[s._v("localhost")]),s._v(" 会怎么样呢？你知道这几个"),t("code",[s._v("IP")]),s._v("有什么区别吗？")]),s._v(" "),t("p",[s._v("以前面试的时候就遇到过这个问题，大家看个动图了解下面试官和我当时的场景，求当时我的心里阴影面积。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/c3a97f36607c0e7ef6805bfba482a060.gif",alt:"图片"}})]),s._v(" "),t("p",[s._v("话不多说，我们直接开车。")]),s._v(" "),t("p",[s._v("拔掉网线，断网。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/5137bc7bce08dc60cfa2f8152b738dfd.jpeg",alt:"图片"}})]),s._v(" "),t("p",[s._v("然后在控制台输入"),t("code",[s._v("ping 127.0.0.1")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\nPING "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" data bytes\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.080")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.093")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.074")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.079")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.079")]),s._v(" ms\n^C\n--- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" packets transmitted, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" packets received, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("% packet loss\nround-trip min/avg/max/stddev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.074")]),s._v("/0.081/0.093/0.006 ms\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("说明，拔了网线，"),t("code",[s._v("ping 127.0.0.1")]),s._v(" 是"),t("strong",[s._v("能 ping 通的")]),s._v("。")]),s._v(" "),t("p",[s._v("其实这篇文章看到这里，标题前半个问题已经被回答了。但是我们可以再想深一点。")]),s._v(" "),t("p",[s._v("为什么断网了还能 "),t("code",[s._v("ping")]),s._v(" 通 "),t("code",[s._v("127.0.0.1")]),s._v(" 呢？")]),s._v(" "),t("p",[t("strong",[s._v("这能说明你不用交网费就能上网吗？")])]),s._v(" "),t("p",[t("strong",[s._v("不能。")])]),s._v(" "),t("p",[s._v("首先我们需要进入基础科普环节。")]),s._v(" "),t("p",[s._v("不懂的同学看了就懂了，懂的看了就当查漏补缺吧。")]),s._v(" "),t("h2",{attrs:{id:"什么是-127-0-0-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是-127-0-0-1"}},[s._v("#")]),s._v(" 什么是 127.0.0.1")]),s._v(" "),t("p",[s._v("首先，这是个 "),t("code",[s._v("IPV4")]),s._v(" 地址。")]),s._v(" "),t("p",[t("code",[s._v("IPV4")]),s._v(" 地址有 "),t("code",[s._v("32")]),s._v(" 位，一个字节有 "),t("code",[s._v("8")]),s._v(" 位，共 "),t("code",[s._v("4")]),s._v(" 个字节。")]),s._v(" "),t("p",[s._v("其中"),t("strong",[s._v("127 开头的都属于回环地址")]),s._v("，也是 "),t("code",[s._v("IPV4")]),s._v(" 的特殊地址，没什么道理，就是人为规定的。")]),s._v(" "),t("p",[s._v("而"),t("code",[s._v("127.0.0.1")]),s._v("是"),t("strong",[s._v("众多")]),s._v("回环地址中的一个。之所以不是 "),t("code",[s._v("127.0.0.2")]),s._v(" ，而是 "),t("code",[s._v("127.0.0.1")]),s._v("，是因为源码里就是这么定义的，也没什么道理。")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Address to loopback in software to local host.  */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("INADDR_LOOPBACK")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token expression"}},[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x7f000001")]),s._v("  ")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 127.0.0.1   */")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/fa904fbcf66cc7abf510a8dc16f867fa.png",alt:"图片"}})]),s._v(" "),t("p",[t("code",[s._v("IPv4")]),s._v(" 的地址是 "),t("code",[s._v("32")]),s._v(" 位的，2 的 32 次方，大概是"),t("code",[s._v("40+亿")]),s._v("。地球光人口就 76 亿了，40 亿 IP 这点量，"),t("strong",[s._v("塞牙缝都不够")]),s._v("，实际上"),t("strong",[s._v("IP 也确实用完")]),s._v("了。")]),s._v(" "),t("p",[s._v("所以就有了"),t("code",[s._v("IPV6")]),s._v("， "),t("code",[s._v("IPv6")]),s._v(" 的地址是 "),t("code",[s._v("128")]),s._v(" 位的，大概是 2 的 128 次方≈"),t("strong",[s._v("10 的 38 次方")]),s._v("。据说地球的沙子数量大概是 "),t("strong",[s._v("10 的 23 次方")]),s._v("，所以 IPV6 的 IP 可以认为用不完。")]),s._v(" "),t("p",[s._v("IPV4 以 8 位一组，每组之间用 "),t("strong",[s._v(".")]),s._v(" 号隔开。")]),s._v(" "),t("p",[s._v("IPV6 就以 16 位为一组，每组之间用 "),t("strong",[s._v(":")]),s._v(" 号隔开。如果全是 0，那么可以省略不写。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/e841adeeecf9451e1aca296d5c7a7f30.png",alt:"图片"}})]),s._v(" "),t("p",[s._v("在 IPV4 下的回环地址是 "),t("code",[s._v("127.0.0.1")]),s._v("，在"),t("code",[s._v("IPV6")]),s._v("下，表达为 "),t("code",[s._v("::1")]),s._v(" 。中间把"),t("strong",[s._v("连续的 0")]),s._v("给省略了，之所以不是"),t("strong",[s._v("7 个 冒号")]),s._v("，而是"),t("strong",[s._v("2 个冒号：")]),s._v(" ，是因为一个 IPV6 地址中"),t("strong",[s._v("只允许出现⼀次两个连续的冒号")]),s._v("。")]),s._v(" "),t("blockquote",[t("p",[s._v("多说一句：在 IPV4 下用的是 "),t("strong",[s._v("ping 127.0.0.1")]),s._v(" 命令。在 IPV6 下用的是 "),t("strong",[s._v("ping6  ::1")]),s._v(" 命令。")])]),s._v(" "),t("h2",{attrs:{id:"什么是-ping"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是-ping"}},[s._v("#")]),s._v(" 什么是 ping")]),s._v(" "),t("p",[s._v("ping 是应用层命令，可以理解为它跟游戏或者聊天软件属于同一层。只不过聊天软件可以收发消息，还能点个赞什么的，有很多复杂的功能。而 ping 作为一个小软件，它的功能比较简单，就是"),t("strong",[s._v("尝试")]),s._v("发送一个小小的消息到目标机器上，判断目的机器是否"),t("strong",[s._v("可达")]),s._v("，其实也就是判断目标机器网络是否能连通。")]),s._v(" "),t("p",[s._v("ping 应用的底层，用的是网络层的"),t("strong",[s._v("ICMP 协议")]),s._v("。")]),s._v(" "),t("p",[s._v("IP 和 ICMP 和 Ping 所在分层")]),s._v(" "),t("p",[s._v("虽然 ICMP 协议和 IP 协议"),t("strong",[s._v("都属于网络层协议")]),s._v("，但其实"),t("strong",[s._v("ICMP 也是利用了 IP 协议进行消息的传输")]),s._v("。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/8e0aba146432baeb407ab445292c8019.png",alt:"图片"}})]),s._v(" "),t("p",[s._v("所以，大家在这里完全可以简单的理解为 ping 某个 IP 就是往某个 IP 地址发个消息。")]),s._v(" "),t("h2",{attrs:{id:"tcp-发数据和-ping-的区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp-发数据和-ping-的区别"}},[s._v("#")]),s._v(" TCP 发数据和 ping 的区别")]),s._v(" "),t("p",[s._v("一般情况下，我们会使用 TCP 进行网络数据传输，那么我们可以看下它和 ping 的区别。")]),s._v(" "),t("p",[t("em",[s._v("PS：下图中有一处画错了，右边是 tcp 数据，而不是 ping 数据，我偷懒就不重画了")]),s._v("。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/eb0963a11439dff361dbe0e7a8876abd.png",alt:"图片"}})]),s._v(" "),t("p",[s._v("ping 和其他应用层软件都属于"),t("strong",[s._v("应用层")]),s._v("。")]),s._v(" "),t("p",[s._v("那么我们横向对比一下，比方说聊天软件，如果用的是 TCP 的方式去发送消息。")]),s._v(" "),t("p",[s._v("为了发送消息，那就得先知道往哪发。linux 里万物皆文件，那你要发消息的目的地，也是个文件，这里就引出了 socket 的概念。")]),s._v(" "),t("p",[s._v("要使用 "),t("code",[s._v("socket")]),s._v(" , 那么首先需要创建它。")]),s._v(" "),t("p",[s._v("在 TCP 传输中创建的方式是  "),t("code",[s._v("socket(AF_INET, SOCK_STREAM, 0);")]),s._v("，其中 "),t("code",[s._v("AF_INET")]),s._v(" 表示将使用 IPV4 里 "),t("strong",[s._v("host:port")]),s._v(" 的方式去解析待会你输入的网络地址。"),t("code",[s._v("SOCK_STREAM")]),s._v(" 是指使用面向字节流的 TCP 协议，"),t("strong",[s._v("工作在传输层")]),s._v("。")]),s._v(" "),t("p",[s._v("创建好了 "),t("code",[s._v("socket")]),s._v(" 之后，就可以愉快的把要传输的数据写到这个文件里。调用 socket 的"),t("code",[s._v("sendto")]),s._v("接口的过程中进程会从"),t("strong",[s._v("用户态进入到内核态")]),s._v("，最后会调用到 "),t("code",[s._v("sock_sendmsg")]),s._v(" 方法。")]),s._v(" "),t("p",[s._v("然后进入传输层，带上"),t("code",[s._v("TCP")]),s._v("头。网络层带上"),t("code",[s._v("IP")]),s._v("头，数据链路层带上 "),t("code",[s._v("MAC")]),s._v("头等一系列操作后。进入网卡的"),t("strong",[s._v("发送队列 ring buffer")]),s._v(" ，顺着网卡就发出去了。")]),s._v(" "),t("p",[s._v("回到 "),t("code",[s._v("ping")]),s._v(" ，整个过程也基本跟 "),t("code",[s._v("TCP")]),s._v(" 发数据类似，差异的地方主要在于，创建 "),t("code",[s._v("socket")]),s._v(" 的时候用的是  "),t("code",[s._v("socket(AF_INET,SOCK_RAW,IPPROTO_ICMP)")]),s._v("，"),t("code",[s._v("SOCK_RAW")]),s._v(" 是原始套接字，"),t("strong",[s._v("工作在网络层")]),s._v("，所以构建"),t("code",[s._v("ICMP")]),s._v("（网络层协议）的数据，是再合适不过了。ping 在进入内核态后最后也是调用的  "),t("code",[s._v("sock_sendmsg")]),s._v(" 方法，进入到网络层后加上"),t("strong",[s._v("ICMP 和 IP 头")]),s._v("后，数据链路层加上"),t("strong",[s._v("MAC 头")]),s._v("，也是顺着网卡发出。因此 本质上 ping 跟 普通应用发消息 在程序流程上没太大差别。")]),s._v(" "),t("p",[s._v("这也解释了"),t("strong",[s._v("为什么当你发现怀疑网络有问题的时候，别人第一时间是问你能 ping 通吗？")]),s._v(" 因为可以简单理解为 ping 就是自己组了个数据包，让系统按着其他软件发送数据的路径往外发一遍，能通的话说明其他软件发的数据也能通。")]),s._v(" "),t("h2",{attrs:{id:"为什么断网了还能-ping-通-127-0-0-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么断网了还能-ping-通-127-0-0-1"}},[s._v("#")]),s._v(" 为什么断网了还能 ping 通 127.0.0.1")]),s._v(" "),t("p",[s._v("前面提到，有网的情况下，ping 最后是"),t("strong",[s._v("通过网卡")]),s._v("将数据发送出去的。")]),s._v(" "),t("p",[s._v("那么断网的情况下，网卡已经不工作了，ping 回环地址却一切正常，我们可以看下这种情况下的工作原理。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/c1019a8be584b27c4fc8b8abda9d3cf1.png",alt:"图片"}})]),s._v(" "),t("p",[s._v("从应用层到传输层再到网络层。这段路径跟 ping 外网的时候是几乎是一样的。到了网络层，系统会根据目的 IP，在路由表中获取对应的"),t("strong",[s._v("路由信息")]),s._v("，而这其中就包含选择"),t("strong",[s._v("哪个网卡")]),s._v("把消息发出。")]),s._v(" "),t("p",[s._v("当发现"),t("strong",[s._v("目标 IP 是外网 IP")]),s._v('时，会从"真网卡"发出。')]),s._v(" "),t("p",[s._v("当发现"),t("strong",[s._v("目标 IP 是回环地址")]),s._v("时，就会选择"),t("strong",[s._v("本地网卡")]),s._v("。")]),s._v(" "),t("p",[s._v("本地网卡，其实就是个 "),t("strong",[s._v('"')]),s._v(" "),t("strong",[s._v("假网卡")]),s._v(" "),t("strong",[s._v('"')]),s._v('，它不像"真网卡"那样有个'),t("code",[s._v("ring buffer")]),s._v('什么的，"假网卡"会把数据推到一个叫 '),t("code",[s._v("input_pkt_queue")]),s._v(" 的 "),t("strong",[s._v("链表")]),s._v(" 中。这个链表，其实是所有网卡共享的，上面挂着发给本机的各种消息。消息被发送到这个链表后，会再触发一个"),t("strong",[s._v("软中断")]),s._v("。")]),s._v(" "),t("p",[s._v("专门处理软中断的工具人 "),t("strong",[s._v('"')]),s._v(" "),t("strong",[s._v("ksoftirqd")]),s._v(" "),t("strong",[s._v('"')]),s._v("（这是个"),t("strong",[s._v("内核线程")]),s._v("），它在收到软中断后就会立马去链表里把消息取出，然后顺着数据链路层、网络层等层层往上传递最后给到应用程序。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/a207c14a5416f44e9dbf0fe0a41179e4.png",alt:"图片"}})]),s._v(" "),t("p",[s._v("ping 回环地址和"),t("strong",[s._v("通过 TCP 等各种协议发送数据到回环地址")]),s._v('都是走这条路径。整条路径从发到收，都没有经过"真网卡"。'),t("strong",[s._v("之所以 127.0.0.1 叫本地回环地址，可以理解为，消息发出到这个地址上的话，就不会出网络，在本机打个转就又回来了。")]),s._v(" 所以断网，依然能 "),t("code",[s._v("ping")]),s._v(" 通 "),t("code",[s._v("127.0.0.1")]),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"ping-回环地址和-ping-本机地址有什么区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ping-回环地址和-ping-本机地址有什么区别"}},[s._v("#")]),s._v(" ping 回环地址和 ping 本机地址有什么区别")]),s._v(" "),t("p",[s._v("我们在 mac 里执行 "),t("code",[s._v("ifconfig")]),s._v(" 。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\nlo0: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("804")]),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v("<")]),s._v("UP,LOOPBACK,RUNNING,MULTICAST"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 netmask 0xff000000\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nen0: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("886")]),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".31.6 netmask 0xffffff00 broadcast "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".31.255\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("能看到 "),t("strong",[s._v("lo0")]),s._v("，表示本地回环接口，对应的地址，就是我们前面提到的 "),t("strong",[s._v("127.0.0.1")]),s._v(" ，也就是"),t("strong",[s._v("回环地址")]),s._v("。")]),s._v(" "),t("p",[s._v("和 "),t("strong",[s._v("eth0")]),s._v("，表示本机第一块网卡，对应的 IP 地址是"),t("strong",[s._v("192.168.31.6")]),s._v("，管它叫"),t("strong",[s._v("本机 IP")]),s._v("。")]),s._v(" "),t("p",[s._v('之前一直认为 ping 本机 IP 的话会通过"真网卡"出去，然后遇到第一个路由器，再发回来到本机。')]),s._v(" "),t("p",[s._v("为了验证这个说法，可以进行抓包，但结果跟上面的说法并不相同。")]),s._v(" "),t("p",[s._v("ping 127.0.0.1:")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/bc2765b1d6d3e37a5663f98085198926.png",alt:"图片"}})]),s._v(" "),t("p",[s._v("ping 本机地址：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/50cd584f9f82aee8d3d9bfaf7d910cb8.png",alt:"图片"}})]),s._v(" "),t("p",[s._v("可以看到 ping 本机 IP 跟 ping 回环地址一样，相关的网络数据，都是走的  "),t("strong",[s._v("lo0")]),s._v('，本地回环接口，也就是前面提到的**"假网卡"**。')]),s._v(" "),t("p",[s._v("只要走了本地回环接口，那数据都不会发送到网络中，在本机网络协议栈中兜一圈，就发回来了。因此 "),t("strong",[s._v("ping 回环地址和 ping 本机地址没有区别")]),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"_127-0-0-1-和-localhost-以及-0-0-0-0-有区别吗"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_127-0-0-1-和-localhost-以及-0-0-0-0-有区别吗"}},[s._v("#")]),s._v(" 127.0.0.1 和 localhost 以及 0.0.0.0 有区别吗")]),s._v(" "),t("p",[s._v("回到文章开头动图里的提问，算是面试八股文里的老常客了。")]),s._v(" "),t("p",[s._v("以前第一次用 "),t("code",[s._v("nginx")]),s._v(" 的时候，发现用这几个 "),t("code",[s._v("IP")]),s._v("，都能正常访问到 "),t("code",[s._v("nginx")]),s._v(" 的欢迎网页。一度认为这几个 "),t("code",[s._v("IP")]),s._v(" 都是一样的。")]),s._v(" "),t("p",[s._v("访问 127.0.0.1:80")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/12e13316a18009ce8b2983846819e270.png",alt:"图片"}})]),s._v(" "),t("p",[s._v("访问 localhost:80")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/2c35f573e91e94733d009384a4657859.png",alt:"图片"}})]),s._v(" "),t("p",[s._v("访问 0.0.0.0:80")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/ba534fdc5f21b3ab26d0b8c890bb02c3.png",alt:"图片"}})]),s._v(" "),t("p",[s._v("访问本机的 IP 地址")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/9b31572ced19805fab02a23b22819b92.png",alt:"图片"}})]),s._v(" "),t("p",[s._v("但本质上还是有些区别的。")]),s._v(" "),t("p",[s._v("首先 "),t("code",[s._v("localhost")]),s._v(" 就不叫 "),t("code",[s._v("IP")]),s._v("，它是一个域名，就跟 "),t("code",[s._v('"baidu.com"')]),s._v(",是一个形式的东西，只不过默认会把它解析为 "),t("code",[s._v("127.0.0.1")]),s._v(" ，当然这可以在 "),t("code",[s._v("/etc/hosts")]),s._v(" 文件下进行修改。")]),s._v(" "),t("p",[s._v("所以默认情况下，使用 "),t("code",[s._v("localhost")]),s._v(" 跟使用  "),t("code",[s._v("127.0.0.1")]),s._v(" 确实是没区别的。")]),s._v(" "),t("p",[s._v("其次就是 "),t("code",[s._v("0.0.0.0")]),s._v("，执行 ping 0.0.0.0，是会失败的，因为它在"),t("code",[s._v("IPV4")]),s._v("中表示的是无效的"),t("strong",[s._v("目标地址")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\nPING "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" data bytes\nping: sendto: No route to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\nping: sendto: No route to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("但它还是很有用处的，回想下，我们启动服务器的时候，一般会 "),t("code",[s._v("listen")]),s._v(" 一个 IP 和端口，等待客户端的连接。")]),s._v(" "),t("p",[s._v("如果此时 "),t("code",[s._v("listen")]),s._v(" 的是本机的 "),t("code",[s._v("0.0.0.0")]),s._v(" , 那么它表示本机上的"),t("strong",[s._v("所有 IPV4 地址")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Address to accept any incoming messages. */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("INADDR_ANY")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token expression"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 0.0.0.0   */")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("举个例子。刚刚提到的 "),t("code",[s._v("127.0.0.1")]),s._v(" 和 "),t("code",[s._v("192.168.31.6")]),s._v(" ，都是本机的 IPV4 地址，如果监听 "),t("code",[s._v("0.0.0.0")]),s._v(" ，那么用上面两个地址，都能访问到这个服务器。")]),s._v(" "),t("p",[s._v("当然，客户端 "),t("code",[s._v("connect")]),s._v(" 时，不能使用 "),t("code",[s._v("0.0.0.0")]),s._v(" 。必须指明要连接哪个服务器 IP。")]),s._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("127.0.0.1")]),s._v(" 是"),t("strong",[s._v("回环地址")]),s._v("。"),t("code",[s._v("localhost")]),s._v("是"),t("strong",[s._v("域名")]),s._v("，但默认等于 "),t("code",[s._v("127.0.0.1")]),s._v("。")]),s._v(" "),t("li",[t("code",[s._v("ping")]),s._v(" 回环地址和 "),t("code",[s._v("ping")]),s._v(" 本机地址，是一样的，走的是"),t("strong",[s._v('lo0 "假网卡"')]),s._v("，都会经过网络层和数据链路层等逻辑，最后在快要出网卡前"),t("strong",[s._v("狠狠拐了个弯")]),s._v("，将数据插入到一个"),t("strong",[s._v("链表")]),s._v("后就"),t("strong",[s._v("软中断")]),s._v("通知 "),t("strong",[s._v("ksoftirqd")]),s._v(" 来进行"),t("strong",[s._v("收数据")]),s._v("的逻辑，"),t("strong",[s._v("压根就不出网络")]),s._v("。所以断网了也能 "),t("code",[s._v("ping")]),s._v(" 通回环地址。")]),s._v(" "),t("li",[s._v("如果服务器 "),t("code",[s._v("listen")]),s._v(" 的是 "),t("code",[s._v("0.0.0.0")]),s._v("，那么此时用"),t("code",[s._v("127.0.0.1")]),s._v("和本机地址"),t("strong",[s._v("都可以")]),s._v("访问到服务。")])]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("哈喽，我是小林，就爱图解计算机基础，如果觉得文章对你有帮助，别忘记关注我哦！")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost2/%E5%85%B6%E4%BB%96/%E5%85%AC%E4%BC%97%E5%8F%B7%E4%BB%8B%E7%BB%8D.png",alt:"img"}})])])}),[],!1,null,null,null);t.default=_.exports}}]);